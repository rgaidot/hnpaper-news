---
interface Props {
  title: string;
  slug: string;
  readingTime?: number;
}

const { title, slug, readingTime } = Astro.props;
---

<div class="tts-player-container flex flex-wrap items-center justify-between gap-4 w-full px-2 py-2" data-title={title} data-slug={slug}>
  
  <div class="flex items-center space-x-2">
    <button class="play-pause-tts p-2 rounded-full tts-button-style transition-colors duration-200" aria-label="Lancer la lecture" title="Lancer la lecture">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </button>
    <button class="stop-tts p-2 rounded-full tts-stop-button-style transition-colors duration-200 hidden" aria-label="Arrêter la lecture" title="Arrêter la lecture">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
      </svg>
    </button>

    <div class="flex flex-col">
      {readingTime && (
        <span class="tts-reading-time text-xs font-sans font-bold uppercase tracking-widest text-stone-500" data-base-time={readingTime}>{readingTime} min</span>
      )}
      <select class="tts-speed p-1 rounded bg-transparent hover:bg-stone-200 text-stone-800 transition-colors duration-200 border-none text-xs cursor-pointer outline-none font-medium" aria-label="Vitesse de lecture">
        <option value="0.50">0.50x</option>
        <option value="0.75">0.75x</option>
        <option value="1" selected>1x</option>
        <option value="1.25">1.25x</option>
        <option value="1.5">1.5x</option>
        <option value="1.75">1.75x</option>
        <option value="2">2x</option>
      </select>
    </div>
  </div>

  <div class="flex items-center space-x-2">
    <button class="cast-tts p-2 rounded-full tts-button-style transition-colors duration-200 hidden" aria-label="Caster l'audio" title="Caster l'audio">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
        <path d="M1,18L1,21L4,21C4,19.34 2.66,18 1,18M1,14L1,16C3.76,16 6,18.24 6,21L8,21C8,17.13 4.87,14 1,14M1,10L1,12C5.97,12 10,16.03 10,21L12,21C12,14.92 7.07,10 1,10M21,3L3,3C1.9,3 1,3.9 1,5L1,8L3,8L3,5L21,5L21,19L14,19L14,21L21,21C22.1,21 23,20.1 23,19L23,5C23,3.9 22.1,3 21,3Z" />
      </svg>
    </button>
    
    <a href={`/player/${slug}`} target="_blank" aria-label="Écouter le fichier audio" title="Écouter le fichier audio" class="download-audio p-2 rounded-full tts-button-style transition-colors duration-200 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
      </svg>
    </a>
  </div>
</div>

<script>
  import { TTSController } from '../scripts/client/TTSController';

  function init() {
    document.querySelectorAll('.tts-player-container').forEach(container => {
        if (container.hasAttribute('data-tts-initialized')) return;
        
        container.setAttribute('data-tts-initialized', 'true');
        
        new TTSController({
            container: container as HTMLElement,
            articleContentSelector: '.prose'
        });
    });
  }

  document.addEventListener('astro:page-load', init);
  
  if (document.readyState === 'complete') {
    init();
  } else {
    document.addEventListener('DOMContentLoaded', init);
  }
</script>
