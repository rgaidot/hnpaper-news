---
interface Props {
  title: string;
  readingTime?: number;
}

const { title, readingTime } = Astro.props;
---

<div class="tts-player-container flex items-center justify-center space-x-2 mt-4" data-title={title}>
  <button class="play-pause-tts p-2 rounded-full tts-button-style transition-colors duration-200">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
      <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  </button>
  <button class="stop-tts p-2 rounded-full tts-stop-button-style transition-colors duration-200 hidden">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
    </svg>
  </button>
  <select class="tts-speed p-2 rounded bg-stone-200 hover:bg-stone-300 text-stone-800 transition-colors duration-200 border-none text-sm cursor-pointer outline-none font-medium" aria-label="Vitesse de lecture">
    <option value="0.75">0.75x</option>
    <option value="1" selected>1x</option>
    <option value="1.25">1.25x</option>
    <option value="1.5">1.5x</option>
    <option value="2">2x</option>
    <option value="2.5">2.5x</option>
    <option value="3">3x</option>
    <option value="3.5">3.5x</option>
    <option value="4">4x</option>
    <option value="4.5">4.5x</option>
    <option value="5">5x</option>
    <option value="5.5">5.5x</option>
    <option value="6">6x</option>
    <option value="6.5">6.5x</option>
    <option value="7">7x</option>
  </select>
  {readingTime && (
    <span class="tts-reading-time text-xs font-sans font-bold uppercase tracking-widest text-stone-500" data-base-time={readingTime}>{readingTime} min</span>
  )}
  <span class="tts-status text-sm text-stone-600 italic">Prêt à lire</span>
</div>

<script>
  import { TTSController } from '../scripts/client/TTSController';

  function init() {
    document.querySelectorAll('.tts-player-container').forEach(container => {
        // Prevent double init
        if (container.hasAttribute('data-tts-initialized')) return;
        
        container.setAttribute('data-tts-initialized', 'true');
        
        new TTSController({
            container: container as HTMLElement,
            articleContentSelector: '.prose'
        });
    });
  }

  // Support View Transitions
  document.addEventListener('astro:page-load', init);
  // Fallback for first load if not using VT or if script runs late
  if (document.readyState !== 'loading') {
    init();
  } else {
    document.addEventListener('DOMContentLoaded', init);
  }
</script>
