---
import { getCollection } from 'astro:content';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';
import LayoutPlayer from '../../layouts/LayoutPlayer.astro';
import TTSPlayer from '../../components/TTSPlayer.astro';
import AudioPlayer from '../../components/AudioPlayer.astro';
import ArticleFloatingNav from '../../components/ArticleFloatingNav.astro';
import VoiceVisualizer from '../../components/VoiceVisualizer.astro';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const formattedDate = format(entry.data.date, 'EEEE d MMMM yyyy Ã  HH:mm', {
  locale: fr,
});

const wordsPerMinute = 200;
const words = entry.body.trim().split(/\s+/).length;
const readingTime = Math.ceil(words / wordsPerMinute);
---
<LayoutPlayer title={`Lecture : ${entry.data.title}`}>
  <ArticleFloatingNav />
  <AudioPlayer title={entry.data.title} slug={entry.slug} formattedDate={formattedDate} />
  
  <div class="flex items-center justify-center w-full">
    <div class="w-full">
      <VoiceVisualizer />
    </div>
  </div>
</LayoutPlayer>
