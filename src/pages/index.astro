---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allNews = await getCollection('news');
const sortedNews = allNews.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const latestNews = sortedNews.slice(0, 10);
---

<Layout title="The HNPaper Daily">
  
  <!-- Headline Article -->
  {latestNews.length > 0 && (
    <article class="mb-12 pb-12 border-b-2 border-stone-900">
      <div class="max-w-3xl mx-auto">
        <p class="font-serif text-lg md:text-xl text-stone-800 leading-relaxed text-justify first-letter:text-5xl first-letter:font-black first-letter:float-left first-letter:mr-3 first-letter:mt-[-6px]">
          {latestNews[0].body.split('---')[0]?.substring(0, 500).replace(/^#+\s/, '')}...
        </p>
        <div class="mt-4 text-center">
          <a href={`/news/${latestNews[0].slug}`} class="text-sm font-bold uppercase tracking-widest hover:underline">Lire &rarr;</a>
        </div>
      </div>
    </article>
  )}

  <!-- Secondary Articles Grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-12 divide-y md:divide-y-0 divide-stone-300">
    {
      latestNews.slice(1).map((post) => (
        <article class="flex flex-col pt-8 md:pt-0">
          <div class="mb-2 text-xs font-sans font-bold uppercase text-stone-500 flex justify-between border-b border-stone-300 pb-1">
            <span>{new Date(post.data.date).toLocaleDateString('fr-FR', { month: 'short', day: 'numeric' })}</span>
            <span>{new Date(post.data.date).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>
          </div>
          
          <p class="text-stone-700 font-serif text-sm leading-relaxed text-justify line-clamp-6 mb-4">
            {post.body.split('---')[0]?.substring(0, 200).replace(/^#+\s/, '')}...
          </p>

          <div class="mt-auto">
             <a href={`/news/${post.slug}`} class="text-xs font-bold uppercase tracking-widest hover:underline">Lire &rarr;</a>
          </div>
        </article>
      ))
    }
  </div>

  <div class="mt-20 pt-8 border-t-4 border-double border-stone-300 text-center">
    <a href="/news" class="inline-block px-8 py-3 border border-stone-900 text-stone-900 font-bold font-serif hover:bg-stone-900 hover:text-white transition-all">
      Consulter les archives
    </a>
  </div>
</Layout>
