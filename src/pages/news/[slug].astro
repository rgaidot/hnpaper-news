---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const formattedDate = format(entry.data.date, 'EEEE d MMMM yyyy à HH:mm', { locale: fr });
---

<Layout title={entry.data.title}>
  <article class="mx-auto max-w-3xl">
    <!-- Header de l'article -->
    <header class="mb-10 text-center border-b border-stone-200 pb-8">
      <div class="text-sm font-bold tracking-widest text-blue-600 uppercase mb-3">
        {formattedDate}
      </div>
      <h1 class="text-4xl sm:text-5xl font-black text-stone-900 leading-tight mb-6">
        {entry.data.title}
      </h1>
      <div class="flex justify-center items-center space-x-2 text-stone-500 text-sm italic">
        <span>Par {entry.data.author}</span>
        <span>&bull;</span>
        <span>HNPaper News</span>
      </div>
    </header>

    <!-- Contenu Markdown -->
    <div class="prose prose-stone prose-lg max-w-none mx-auto
      prose-headings:font-serif prose-headings:font-bold prose-headings:text-stone-800
      prose-a:text-blue-700 prose-a:no-underline hover:prose-a:underline
      prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-stone-50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:italic
      prose-img:rounded-md prose-img:shadow-md
    ">
      <Content />
    </div>

    <!-- Liens Discussion & Source -->
    <div class="mt-12 pt-8 border-t border-stone-200 text-stone-600 space-y-2">
      {entry.data.discussionUrl && (
        <p>
          <strong>Discussion HN :</strong> <a href={entry.data.discussionUrl} target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Participer à la discussion</a>
        </p>
      )}
      {entry.data.sourceUrl && (
        <p>
          <strong>Article source :</strong> <a href={entry.data.sourceUrl} target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Lire l'article original</a>
        </p>
      )}
    </div>

    <!-- Navigation post-article -->
    <div class="mt-8 pt-4 border-t border-stone-200 flex justify-between">
      <a href="/" class="text-stone-500 hover:text-stone-900 font-medium transition-colors">
        &larr; Retour à l'accueil
      </a>
    </div>
  </article>
</Layout>
