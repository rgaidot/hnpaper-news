---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const formattedDate = format(entry.data.date, 'EEEE d MMMM yyyy à HH:mm', { locale: fr });
---

<Layout title={entry.data.title}>
  <article class="mx-auto max-w-3xl">
    <!-- Header de l'article -->
    <header class="mb-10 text-center border-b-4 border-double border-stone-300 pb-8">
      <div class="flex flex-col items-center space-y-2 text-stone-600 font-sans text-sm uppercase tracking-widest">
        <span class="font-bold">{formattedDate}</span>
        <span class="italic text-xs">Par {entry.data.author}</span>
      </div>
    </header>

    <!-- Contenu Markdown -->
    <div class="prose prose-stone prose-lg max-w-none mx-auto text-justify
      prose-headings:font-serif prose-headings:font-bold prose-headings:text-stone-900
      prose-p:font-serif prose-p:text-stone-800
      prose-a:text-stone-900 prose-a:underline prose-a:decoration-1 hover:prose-a:decoration-2
      prose-blockquote:border-l-2 prose-blockquote:border-stone-900 prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-stone-700
      prose-img:border prose-img:border-stone-900 prose-img:p-1
    ">
      <Content />
    </div>

    <!-- Liens Discussion & Source -->
    <div class="mt-12 pt-8 border-t border-stone-900 flex flex-col sm:flex-row justify-between text-sm font-sans">
      <div class="space-y-1">
        {entry.data.discussionUrl && (
          <p>
            <strong>Discussion HN :</strong> <a href={entry.data.discussionUrl} target="_blank" rel="noopener noreferrer" class="text-stone-900 hover:underline">Participer</a>
          </p>
        )}
        {entry.data.sourceUrl && (
          <p>
            <strong>Source :</strong> <a href={entry.data.sourceUrl} target="_blank" rel="noopener noreferrer" class="text-stone-900 hover:underline">Lire l'original</a>
          </p>
        )}
      </div>
      
      <div class="mt-4 sm:mt-0">
        <a href="/" class="text-stone-900 font-bold uppercase tracking-widest hover:underline">
          &larr; Retour à la Une
        </a>
      </div>
    </div>
  </article>
</Layout>
